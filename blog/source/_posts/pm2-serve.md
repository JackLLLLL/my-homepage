---
title: æœåŠ¡å™¨é…ç½®é™æ€ç½‘é¡µæ—¶...
date: 2019-03-11 11:59:48
tags: nginx, pm2, serve, static files
---

æŠŠhexoç”Ÿæˆçš„htmlå’Œç›¸å…³èµ„æºscpåˆ°cloud serverï¼Œå‡†å¤‡éƒ¨ç½²é™æ€é¡µé¢åå‘ç”Ÿäº†äº›é—®é¢˜ï¼Œ å°è¯•äº†ä¸‰ç§æ–¹æ³•nginxï¼Œ pm2-serve, è¿˜æœ‰~~æœ€åæˆåŠŸçš„~~serve

## pm2-serve
è¿™æ˜¯æœ€æ—©ä½¿ç”¨çš„æ–¹æ³•ï¼Œä¹Ÿåœ¨è¿™é‡Œè€½è¯¯äº†å¾ˆä¹…ã€‚æœ¬æ¥æƒ³ç›´æ¥é€šè¿‡pm2-serveé™æ€æ–‡ä»¶å¤¹ï¼Œç„¶ånginxä»£ç†åˆ°æœ¬åœ°ç«¯å£çš„æ–¹å¼ï¼Œå´å‘ç°åªèƒ½è®¿é—®blogé¦–é¡µã€‚  
åœ¨nginxé…ç½®é‡Œé€šè¿‡'location ^~ /blog/'çš„æ–¹å¼åŒ¹é…blogå¼€å¤´çš„æ‰€æœ‰è·¯å¾„ï¼Œ  
ä½†åœ¨è®¿é—®jacklllll.xyz/blog/archives/çš„æ—¶å€™å´æ˜¾ç¤ºâ€˜EISDIRâ€˜ï¼Œå­—é¢æ„æ€å¥½åƒæ˜¯è®¿é—®åˆ°äº†æ–‡ä»¶å¤¹ï¼Ÿäºæ˜¯å°è¯•äº†ä¸€ä¸‹åœ¨urlååŠ ä¸Šindex.htmlï¼Œç»ˆäºå¯ä»¥æˆåŠŸè®¿é—®äº†  
ç¬¬ä¸€ååº”æ˜¯æƒ³åœ¨æ¯æ¡åŒ¹é…åˆ°çš„urlåé€šè¿‡nginx rewriteæ·»åŠ index.htmlï¼Œä½†æŸ¥äº†ä¸€ä¼šèµ„æ–™è¿˜æ˜¯æ²¡ä»€ä¹ˆæ€ç»ªï¼Œäºæ˜¯å°è¯•ç€æ¢ç§æ–¹æ³• ğŸ™„  

## nginx
çœ‹äº†ä¸‹ç½‘ä¸Šå¾ˆå¤šäººéƒ½ç›´æ¥ç”¨nginx rootæˆ–è€…aliasæ¥è¯»å–static filesï¼Œäºæ˜¯å°è¯•äº†ä¸€ä¸‹ï¼Œ  
ä½†å‘ç°nginxä¼šæŠ¥é”™ï¼Œ'cannot start high performance website and proxy server at the same time ...'ï¼Œå¤§æ¦‚å°±æ˜¯è¿™ä¸ªæ„æ€ï¼Œä¸å¤ªè®°å¾—å…·ä½“çš„é”™è¯¯ä¿¡æ¯äº†  
è¿™æ¡è·¯å¤§æ¦‚ä¹Ÿæ˜¯èµ°ä¸é€šäº†ï¼Œæˆ‘åœ¨æœåŠ¡å™¨ä¸Šè¿˜è·‘äº†homepageï¼Œé€šè¿‡nginx listen 443ç„¶åproxyï¼Œäºæ˜¯ä¼šç«¯å£å†²çªï¼Œè€Œä¸”ä¸å¤ªå–œæ¬¢æŠŠä¸¤ä¸ªä¸œè¥¿ä¸€ä¸ªæ”¾åˆ°pm2ä¸€ä¸ªæ”¾åˆ°nginxï¼Œå¯èƒ½æ˜¯å¼ºè¿«ç—‡å§hhhï¼Œä¹Ÿå°±æ²¡æœ‰å¤ªå¤šå°è¯•  

## npm install serve
serveæ˜¯ä¸€ä¸ªnpmä¸Šçš„åŒ…ï¼Œä¹‹å‰åœ¨ç”¨create-react-appæ—¶ç”¨è¿‡ï¼Œåæ¥å‘ç°èƒ½ç”¨pm2-serveä»£æ›¿ï¼Œç°åœ¨åˆå›åˆ°äº†è¿™é‡Œ  
ç›´æ¥serveï¼Œnginxè¿˜æ˜¯åŒ¹é…blogå¼€å¤´çš„è·¯å¾„ï¼Œä¸€æ¬¡æˆåŠŸï¼  
è¿™ä¹ˆçœ‹æ¥serveå’Œpm2-serveè¿˜æ˜¯ä¸å¤ªä¸€æ ·ï¼Œserveä¼šè‡ªåŠ¨æ‰¾æ–‡ä»¶å¤¹ä¸‹é¢çš„index.html  
å…·ä½“ä¸ºä»€ä¹ˆå°±ä»¥åå†çœ‹å§ï¼Œ  
hexoçš„blogæˆåŠŸå»ºå¥½äº†ï½ ğŸ¤ª

### 2019-03-11 Update
ç»“æœå‘ç°serveè¿˜æ˜¯æ²¡èƒ½å®Œç¾è§£å†³ï¼Œåæ¥çœ‹pm2çš„issuesï¼Œå‘ç°äº†[ç›¸å…³é—®é¢˜](https://github.com/Unitech/pm2/issues/2941)ï¼Œäºæ˜¯å†³å®šè‡ªå·±æ”¹ä»£ç è§£å†³ï¼Œåˆ›äº†PR
``` JavaScript
if (file === '/' || file === '' || file.endsWith('/')) {
    file = file === '' ? '/index.html' : file + 'index.html';
}
```

### 2019-03-21 Update
ä¿®æ”¹äº†PM2çš„ä»£ç ï¼Œå°†404é¡µé¢å¯¼å‘/404/index.htmlè€Œä¸æ˜¯åŸæ¥çš„/404.html  
``` JavaScript
fs.readFile(options.path + '/404/index.html', function (err, content) {
    content = err ? '404 Not Found' : content;
    response.writeHead(404, { 'Content-Type': 'text/html' });
    response.end(content, 'utf-8');
});
```
ä»¥åä¸æ›´æ–°PM2çš„è¯åº”è¯¥æš‚æ—¶ä¹Ÿæ²¡é—®é¢˜
